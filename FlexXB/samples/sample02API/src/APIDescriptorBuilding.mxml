<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" 
	layout="vertical" creationComplete="{init();}" >
	<mx:Script>
		<![CDATA[
			import com.googlecode.flexxb.api.AccessorType;
			import com.googlecode.flexxb.api.FxClass;
			import com.googlecode.flexxb.FlexXBEngine;
			import mx.controls.Alert;
			import model.Person;
			import model.Department;
			[Bindable]
			private var department : Department;
			[Bindable]
			private var departmentXml : XML;
			
			private function init() : void{
				department = new Department("2", "Research & Development");
				department.departmentHead = new Person("Mike","Johnson"); 
				buildAPI();
			}
			
			private function buildAPI() : void{
				var apiClass : FxClass = new FxClass(Person, "Person");				
				//Add class members descriptors
				apiClass.addElement("id", String, AccessorType.READ_WRITE, "ID");
				apiClass.addAttribute("firstName", String, AccessorType.READ_WRITE, "FirstName");
				apiClass.addAttribute("lastName", String, AccessorType.READ_WRITE, "LastName");
				apiClass.addAttribute("age", String, AccessorType.READ_WRITE, "Age");
				apiClass.addElement("position", String, AccessorType.READ_WRITE, "Position");
				//Set the constructpr arguments, if any
				apiClass.addArgument("firstName");
				apiClass.addArgument("lastName");
				//Register the api descriptor class in the FlexXB engine
				FlexXBEngine.instance.api.processTypeDescriptor(apiClass);
				
				apiClass = new FxClass(Department);
				apiClass.alias = "CompanyDepartment";
				apiClass.nameSpace = new Namespace("dept", "http://myCompanyUrl.com");
				//Add clas members descriptors
				apiClass.addAttribute("id", String, AccessorType.READ_WRITE, "ID");
				apiClass.addElement("name", String, AccessorType.READ_WRITE, "DepartmentName");
				apiClass.addElement("departmentHead", Person, AccessorType.READ_WRITE, "Leader");
				//Set the constructpr arguments, if any
				apiClass.addArgument("id");
				apiClass.addArgument("name");
				//Register the api descriptor class in the FlexXB engine
				FlexXBEngine.instance.api.processTypeDescriptor(apiClass);
			}
			
			private function serialize(event : Event) : void{
				departmentXml = FlexXBEngine.instance.serialize(department);
			}
			
			private function deserialize(event : Event) : void{
				department = FlexXBEngine.instance.deserialize(departmentXml, Department) as Department;
			}
			
			private function updateXML(event : Event) : void{
				try{
					departmentXml = XML(event.target.text);
				}catch(e : Error){
					Alert.show(e.message, "Invalid XML");
				}
			}
		]]>
	</mx:Script>
	<mx:Label text="Sample 2 - Serialize and deserialize ActionScript by describing types in FlexXB API" fontWeight="bold" fontSize="16" />
	<mx:HBox verticalAlign="middle" width="100%" height="300" paddingBottom="30"
	paddingLeft="30" paddingRight="30" paddingTop="30">
		<mx:Form width="50%" height="100%">
			<mx:FormHeading label="Fill in the form to configure the department" />
			<mx:FormItem label="Dept ID">
				<mx:TextInput text="{department.id}" restrict="0123456789"
					change="{department.id = event.target.text}"/>
			</mx:FormItem>
			<mx:FormItem label="Dept Name">
				<mx:TextInput text="{department.name}"
					change="{department.name = event.target.text}"/>
			</mx:FormItem>
			<mx:FormItem label="Dept Leader First Name">
				<mx:TextInput text="{department.departmentHead.firstName}"
					change="{department.departmentHead.firstName = event.target.text}"/>
			</mx:FormItem>
			<mx:FormItem label="Dept Leader Last Name">
				<mx:TextInput  text="{department.departmentHead.lastName}"
					change="{department.departmentHead.lastName = event.target.text}"/>
			</mx:FormItem>
			<mx:FormItem label="Dept Leader Age">
				<mx:TextInput restrict="0123456789"  text="{department.departmentHead.age}"
					change="{department.departmentHead.age = Number(event.target.text)}"/>
			</mx:FormItem>
			<mx:FormItem label="Dept Leader Position">
				<mx:TextInput  text="{department.departmentHead.position}"
					change="{department.departmentHead.position = event.target.text}"/>
			</mx:FormItem>
		</mx:Form>
		<mx:VBox width="100%" horizontalAlign="center">
			<mx:Button label="Serialize >>" click="{serialize(event)}"/>
			<mx:Button label="&lt;&lt; Deserialize" click="(deserialize(event))"/>
		</mx:VBox>
		<mx:VBox width="400" height="100%">
			<mx:Label text="XML View"/>
			<mx:TextArea width="400" height="100%" text="{departmentXml.toXMLString()}" change="{updateXML(event)}" />
		</mx:VBox>
	</mx:HBox>
</mx:Application>